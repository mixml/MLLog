# MLLog

[![Language](https://img.shields.io/badge/Language-C%2B%2B-blue.svg)](https://isocpp.org/)
[![License](https://img.shields.io/badge/License-MIT-green.svg)](https://opensource.org/licenses/MIT)
[![Version](https://img.shields.io/badge/Version-2.2-blue.svg)](https://github.com/mixml/MLLog)
![Platform](https://img.shields.io/badge/Platform-Windows%20%7C%20Linux%20%7C%20macOS-lightgrey.svg)

**[English](./README_EN.md) | ä¸­æ–‡**

`MLLog` æ˜¯ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§ã€è½»é‡çº§ã€çº¿ç¨‹å®‰å…¨çš„ C++ å•å¤´æ–‡ä»¶æ—¥å¿—åº“ã€‚å®ƒè¢«è®¾è®¡ä¸ºæ˜“äºé›†æˆå’Œä½¿ç”¨ï¼ŒåŒæ—¶æä¾›äº†ä¸°å¯Œçš„åŠŸèƒ½ï¼Œä»¥æ»¡è¶³ä»ç®€å•å‘½ä»¤è¡Œå·¥å…·åˆ°å¤æ‚æœåŠ¡å™¨åº”ç”¨ç¨‹åºçš„å„ç§æ—¥å¿—è®°å½•éœ€æ±‚ã€‚

## æ ¸å¿ƒç‰¹æ€§

*   ğŸš€ **å•å¤´æ–‡ä»¶**: åªéœ€å°† `mllog.hpp` åŒ…å«åˆ°ä½ çš„é¡¹ç›®ä¸­å³å¯ï¼Œæ— éœ€ç¼–è¯‘æˆ–é“¾æ¥ã€‚
*   ğŸ”’ **çº¿ç¨‹å®‰å…¨**: æ‰€æœ‰æ—¥å¿—æ“ä½œéƒ½ç”±äº’æ–¥é”ä¿æŠ¤ï¼Œå¯åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸­å®‰å…¨ä½¿ç”¨ã€‚
*   âœ¨ **ä¸¤ç§APIé£æ ¼**:
    *   **æµå¼API**: `MLLOG_INFO << "User " << user_id << " logged in.";`
    *   **printfé£æ ¼API**: `MLLOG_ERRORF("Failed with code %d", error_code);`
*   ğŸŒˆ **æ§åˆ¶å°é¢œè‰²**: æ”¯æŒåœ¨æ§åˆ¶å°è¾“å‡ºå¸¦é¢œè‰²çš„æ—¥å¿—ï¼Œä¾¿äºåŒºåˆ†ä¸åŒçº§åˆ«çš„æ—¥å¿—ã€‚
*   ğŸ“„ **çµæ´»çš„è¾“å‡º**: å¯åŒæ—¶å°†æ—¥å¿—è¾“å‡ºåˆ°æ–‡ä»¶å’Œæ§åˆ¶å°ï¼Œæˆ–åªè¾“å‡ºåˆ°å…¶ä¸­ä¹‹ä¸€ã€‚
*   ğŸ”„ **æ—¥å¿—æ»šåŠ¨**:
    *   **æŒ‰å¤§å°æ»šåŠ¨**: å½“æ—¥å¿—æ–‡ä»¶è¾¾åˆ°è®¾å®šå¤§å°æ—¶ï¼Œè‡ªåŠ¨åˆ›å»ºæ–°æ–‡ä»¶ã€‚
    *   **æŒ‰æ–‡ä»¶æ•°æ»šåŠ¨**: ä¿ç•™æŒ‡å®šæ•°é‡çš„æ—¥å¿—æ–‡ä»¶ï¼Œè‡ªåŠ¨è¦†ç›–æœ€æ—§çš„æ–‡ä»¶ã€‚
*   ğŸ“… **æ¯æ—¥æ—¥å¿—**: æ”¯æŒè·¨å¤©æ—¶è‡ªåŠ¨åˆ›å»ºä»¥å½“å¤©æ—¥æœŸå‘½åçš„æ–°æ—¥å¿—æ–‡ä»¶ã€‚
*   ğŸ§¹ **è‡ªåŠ¨æ¸…ç†**: å¯æ ¹æ®è®¾å®šçš„å¤©æ•°è‡ªåŠ¨æ¸…ç†æ—§çš„æ—¥å¿—æ–‡ä»¶ã€‚
*   âš™ï¸ **é«˜åº¦å¯é…ç½®**: å¯è‡ªå®šä¹‰æ—¥å¿—çº§åˆ«ã€æ–‡ä»¶è·¯å¾„ã€æ»šåŠ¨ç­–ç•¥ã€è¾“å‡ºæ ¼å¼ç­‰ã€‚
*   âš¡ **æ€§èƒ½ä¼˜åŒ–**: åŒ…å«æ—¶é—´å­—ç¬¦ä¸²ç¼“å­˜ã€å¯é€‰çš„è‡ªåŠ¨åˆ·æ–°ç­‰æœºåˆ¶ä»¥æå‡æ€§èƒ½ã€‚
*   ğŸ›¡ï¸ **å¥å£®çš„é”™è¯¯å¤„ç†**: å¯è®¾ç½®è‡ªå®šä¹‰é”™è¯¯å¤„ç†å™¨ï¼Œé¿å…æ—¥å¿—åº“å†…éƒ¨é—®é¢˜å½±å“ä¸»ç¨‹åºã€‚

## å¿«é€Ÿå¼€å§‹

### 1. ä¾èµ–

*   C++11 æˆ–æ›´é«˜ç‰ˆæœ¬çš„ç¼–è¯‘å™¨ (ä¾‹å¦‚ g++, clang, MSVC)ã€‚

### 2. å®‰è£…

`MLLog` æ˜¯ä¸€ä¸ªçº¯å¤´æ–‡ä»¶åº“ï¼Œé›†æˆéå¸¸ç®€å•ï¼š

1.  ä¸‹è½½ `mllog.hpp` æ–‡ä»¶ã€‚
2.  å°†å…¶å¤åˆ¶åˆ°ä½ çš„é¡¹ç›®æºç ç›®å½•ä¸­ã€‚
3.  åœ¨ä½ çš„ä»£ç ä¸­ `#include "mllog.hpp"`ã€‚

## ä½¿ç”¨æ–¹æ³•

### åŸºç¡€ç”¨æ³•

```cpp
#include "mllog.hpp"
#include <iostream>
#include <string>
#include <vector>

int main() {
    // 1. å¯åŠ¨æ—¥å¿—ç³»ç»Ÿ (å¿…é¡»)
    MLLOG_START();

    // 2. (å¯é€‰) é…ç½®æ—¥å¿—
    auto& logger = ML_Logger::getInstance();
    logger.setLogFile("./logs/my_app", 5, 10 * 1024 * 1024); // æ—¥å¿—è·¯å¾„: ./logs/my_app, ä¿ç•™5ä¸ªæ»šåŠ¨æ–‡ä»¶, æ¯ä¸ªæœ€å¤§10MB
    logger.setLevel(ML_Logger::DEBUG);                       // è®¾ç½®æ—¥å¿—çº§åˆ«ä¸ºDEBUGï¼Œæ‰€æœ‰çº§åˆ«éƒ½å°†è¾“å‡º
    logger.setOutput(true, true);                            // åŒæ—¶è¾“å‡ºåˆ°æ–‡ä»¶å’Œæ§åˆ¶å°
    logger.setScreenColor(true);                             // å¼€å¯æ§åˆ¶å°é¢œè‰²

    // 3. ä½¿ç”¨æµå¼å®è®°å½•æ—¥å¿—
    MLLOG_INFO << "ç¨‹åºå¯åŠ¨ï¼Œç‰ˆæœ¬: " << 1.0;
    std::string user = "malin";
    MLLOG_DEBUG << "æ­£åœ¨ä¸ºç”¨æˆ· " << user << " å¤„ç†è¯·æ±‚...";
    std::vector<int> data = {1, 2, 3};
    MLLOG_WARNING << "æ£€æµ‹åˆ°æ•°æ®å¼‚å¸¸ï¼Œå¤§å°: " << data.size();

    // 4. ä½¿ç”¨æ ¼å¼åŒ–å®è®°å½•æ—¥å¿— (printf-style)
    MLLOG_ERRORF("å¤„ç†å¤±è´¥ï¼Œé”™è¯¯ç : %d, é”™è¯¯ä¿¡æ¯: %s", 1001, "æ–‡ä»¶æœªæ‰¾åˆ°");
    MLLOG_CRITICALF("ç³»ç»Ÿå…³é”®ç»„ä»¶'%s'æ— å“åº”!", "DatabaseConnector");

    // 5. (å¯é€‰) è®°å½•ä¸€æ¡ç¨‹åºç»“æŸæ—¥å¿—
    MLLOG_ALERT << "---------- Stop MLLOG ----------";

    return 0;
}
```

### è¿›é˜¶ç”¨æ³•

```cpp
#include "mllog.hpp"
#include <iostream>

// è‡ªå®šä¹‰æ—¥å¿—åº“å†…éƒ¨é”™è¯¯å¤„ç†å™¨
void handle_log_system_error(const std::string& error_message) {
    // åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œè¿™é‡Œå¯ä»¥å‘é€è­¦æŠ¥æˆ–å†™å…¥ç´§æ€¥æ—¥å¿—
    std::cerr << "!!! MLLog internal error: " << error_message << std::endl;
}

int main() {
    auto& logger = ML_Logger::getInstance();

    // 1. (æ¨è) åœ¨å¯åŠ¨å‰è®¾ç½®é”™è¯¯å¤„ç†å™¨
    logger.setErrorHandler(handle_log_system_error);

    // 2. å¯åŠ¨æ—¥å¿—ç³»ç»Ÿ
    MLLOG_START();

    // 3. æ›´å¤šé«˜çº§é…ç½®
    logger.setLogFile("./logs/perf_test");
    logger.setLevel(ML_Logger::INFO);
    logger.setAutoFlush(false); // å…³é—­è‡ªåŠ¨åˆ·æ–°ä»¥æå‡é«˜é¢‘å†™å…¥æ€§èƒ½
    logger.setCheckDay(true);   // å¼€å¯è·¨å¤©è‡ªåŠ¨åˆ›å»ºæ–°æ—¥æœŸæ—¥å¿—æ–‡ä»¶åŠŸèƒ½

    // 4. æ€§èƒ½æµ‹è¯• (é«˜é¢‘å†™å…¥)
    for (int i = 0; i < 1000; ++i) {
        MLLOG_INFO << "Processing item " << i;
    }

    // 5. æ‰‹åŠ¨åˆ·æ–°ç¼“å†²åŒºï¼Œç¡®ä¿æ‰€æœ‰æ—¥å¿—éƒ½å·²å†™å…¥ç£ç›˜
    logger.flush();
    MLLOG_INFO << "æ‰€æœ‰æ€§èƒ½æµ‹è¯•æ—¥å¿—å·²åˆ·æ–°åˆ°ç£ç›˜ã€‚";

    // 6. æ¸…ç†7å¤©å‰çš„æ—§æ—¥å¿—æ–‡ä»¶
    logger.cleanupOldLogs(7);
    MLLOG_INFO << "æ—§æ—¥å¿—æ¸…ç†å®Œæˆã€‚";

    return 0;
}
```

## API å‚è€ƒ (ä¸»è¦é…ç½®å‡½æ•°)

é€šè¿‡ `ML_Logger::getInstance()` è·å–å•ä¾‹å¯¹è±¡åï¼Œå¯ä»¥è°ƒç”¨ä»¥ä¸‹å‡½æ•°è¿›è¡Œé…ç½®ï¼š

| å‡½æ•° | æè¿° |
| --- | --- |
| `setLogSwitch(bool)` | **(å¿…éœ€)** å…¨å±€å¼€å…³ï¼Œ`true` å¯ç”¨æ—¥å¿—ç³»ç»Ÿã€‚`MLLOG_START()` å®å·²åŒ…å«æ­¤è°ƒç”¨ã€‚ |
| `setLogFile(baseName, maxRolls, maxSize)` | è®¾ç½®æ—¥å¿—æ–‡ä»¶åŸºç¡€åã€æœ€å¤§æ»šåŠ¨æ–‡ä»¶æ•°å’Œå•ä¸ªæ–‡ä»¶æœ€å¤§å°ºå¯¸ã€‚ |
| `setLevel(Level)` | è®¾ç½®æ—¥å¿—çº§åˆ«ï¼Œä½äºæ­¤çº§åˆ«çš„æ—¥å¿—å°†ä¸ä¼šè¢«è®°å½•ã€‚ |
| `setOutput(toFile, toScreen)` | è®¾ç½®æ—¥å¿—è¾“å‡ºç›®æ ‡ (æ–‡ä»¶ã€æ§åˆ¶å°)ã€‚ |
| `setScreenColor(bool)` | å¯ç”¨æˆ–ç¦ç”¨æ§åˆ¶å°é¢œè‰²è¾“å‡ºã€‚ |
| `setCheckDay(bool)` | å¯ç”¨æˆ–ç¦ç”¨è·¨å¤©è‡ªåŠ¨åˆ›å»ºæ–°æ—¥å¿—æ–‡ä»¶ã€‚ |
| `setAutoFlush(bool)` | è®¾ç½®æ˜¯å¦åœ¨æ¯æ¡æ—¥å¿—åè‡ªåŠ¨åˆ·æ–°æ–‡ä»¶ç¼“å†²åŒºã€‚ä¸ºæ€§èƒ½è€ƒè™‘å¯å…³é—­ã€‚ |
| `setErrorHandler(handler)` | è®¾ç½®ä¸€ä¸ªè‡ªå®šä¹‰å‡½æ•°æ¥å¤„ç†æ—¥å¿—åº“å†…éƒ¨å‘ç”Ÿçš„é”™è¯¯ã€‚ |
| `cleanupOldLogs(daysToKeep)` | æ¸…ç†æŒ‡å®šå¤©æ•°ä¹‹å‰çš„æ—§æ—¥å¿—æ–‡ä»¶ã€‚ |
| `flush()` | æ‰‹åŠ¨å°†æ—¥å¿—ç¼“å†²åŒºå†…å®¹åˆ·æ–°åˆ°æ–‡ä»¶ã€‚ |

## æ€§èƒ½æç¤º

å¯¹äºéœ€è¦é«˜é¢‘å†™å…¥æ—¥å¿—çš„åœºæ™¯ (ä¾‹å¦‚å¾ªç¯ä¸­å¤§é‡è®°å½•)ï¼Œå»ºè®®å…³é—­è‡ªåŠ¨åˆ·æ–°ä»¥è·å¾—æœ€ä½³æ€§èƒ½ï¼Œå¹¶åœ¨é€‚å½“çš„æ—¶æœºæ‰‹åŠ¨è°ƒç”¨ `flush()`ã€‚

```cpp
auto& logger = ML_Logger::getInstance();
logger.setAutoFlush(false); // å…³é—­è‡ªåŠ¨åˆ·æ–°

for (int i = 0; i < 100000; ++i) {
    MLLOG_DEBUG << "Looping fast... " << i;
}

logger.flush(); // åœ¨å¾ªç¯ç»“æŸåæ‰‹åŠ¨åˆ·æ–°
```

## è®¸å¯è¯

æœ¬é¡¹ç›®ä½¿ç”¨ [MIT è®¸å¯è¯](LICENSE)ã€‚

## ä½œè€…

*   **malin**
*   **Email**: `zcyxml@163.com` / `mlin2@grgbanking.com`
*   **GitHub**: <https://github.com/mixml>